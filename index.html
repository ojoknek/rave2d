<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>RAVE 2D</title>
    <meta name="description" content="Intersection of internet and club. Tokyo-based DJ mix brand.">
    <link rel="icon" href="image/RAVE2D-fabicon.svg" type="image/svg+xml">
    <!-- OGP / アイキャッチ（SNSシェア用） -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rave2d.com/">
    <meta property="og:title" content="RAVE 2D">
    <meta property="og:description" content="Intersection of internet and club. Tokyo-based DJ mix brand.">
    <meta property="og:image" content="https://rave2d.com/image/RAVE2D-WHITE.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RAVE 2D">
    <meta name="twitter:description" content="Intersection of internet and club. Tokyo-based DJ mix brand.">
    <meta name="twitter:image" content="https://rave2d.com/image/RAVE2D-WHITE.png">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Zen+Kaku+Gothic+New:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

    <div class="loader" aria-hidden="true">
        <span class="loader-text">SYSTEM LOADING</span>
        <span class="loader-dot">.</span><span class="loader-dot">.</span><span class="loader-dot">.</span>
    </div>

    <div class="grid-container">
        
        <header class="header" data-reveal>
            <a href="./" class="logo-link">
                <img src="image/RAVE2D-WHITE.png" alt="RAVE 2D" class="logo-img">
            </a>
            <div class="sub-text">TOKYO SUB CULTURE<br>DJ CATALOG</div>
        </header>

        <div class="marquee-section marquee-glitch" id="marquee-glitch" aria-hidden="true">
            <div class="glitch-bg"></div>
            <div class="glitch-slice glitch-slice--1"></div>
            <div class="glitch-slice glitch-slice--2"></div>
            <div class="glitch-scan"></div>
            <!-- 青系ゆっくりブレス（CSSアニメーション） -->
            <div class="glitch-burst" aria-hidden="true">
                <div class="glitch-burst-layer glitch-burst--blue-dark"></div>
                <div class="glitch-burst-layer glitch-burst--blue-light"></div>
            </div>
            <div class="glitch-slices-js" id="glitch-slices-js"></div>
            <div class="marquee-bar-row">
                <nav id="nav-menu" class="marquee-nav" aria-hidden="true">
                    <a href="#about" class="marquee-nav-link tab-btn" data-hover role="tab" aria-selected="false">ABOUT</a>
                    <a href="#mix-catalog" class="marquee-nav-link tab-btn" data-hover role="tab" aria-selected="false">CATALOG</a>
                    <a href="#events" class="marquee-nav-link tab-btn" data-hover role="tab" aria-selected="false">EVENTS</a>
                    <a href="#ravewear" class="marquee-nav-link tab-btn" data-hover role="tab" aria-selected="false">RAVE WEAR</a>
                </nav>
                <div class="marquee-menu-wrap">
                    <button type="button" class="hamburger-btn" aria-label="メニューを開く" aria-expanded="false" aria-controls="nav-menu">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </div>
            </div>
        </div>

        <main class="hero">
            <div class="hero-inner">
                <h1 class="hero-title" data-split>
                    <span class="line">RAVE IN <span class="blue-txt">BLUE.</span></span>
                    <span class="line">ARCHIVE IN <span class="blue-txt">2D.</span></span>
                </h1>
                <a href="events/highway/" class="hero-news hero-news-link" data-reveal rel="noopener">
                    <span class="hero-news-label">NEWS</span>
                    <p class="hero-news-text">RAVE 2D:HIGHWAY が02/08(日)18時より開催されます。</p>
                </a>
                <div class="btn-group btn-group--hidden" data-reveal aria-hidden="true">
                    <a href="#about" class="btn tab-btn" data-hover role="tab" aria-selected="false">▼ ABOUT</a>
                    <a href="#mix-catalog" class="btn tab-btn" data-hover role="tab" aria-selected="false">▼ CATALOG</a>
                    <a href="#events" class="btn tab-btn" data-hover role="tab" aria-selected="false">▼ EVENTS</a>
                    <a href="#ravewear" class="btn tab-btn" data-hover role="tab" aria-selected="false">▼ RAVE WEAR</a>
                </div>
            </div>
            <div class="hero-deco" aria-hidden="true">
                <span class="deco-word">RAVE</span><span class="deco-word">2D</span><span class="deco-word">TOKYO</span><span class="deco-word">CLUB</span><span class="deco-word">RAVE</span><span class="deco-word">2D</span><span class="deco-word">TOKYO</span><span class="deco-word">CLUB</span><span class="deco-word">RAVE</span><span class="deco-word">2D</span>
            </div>
        </main>

        <aside class="info-bar">
            <ul>
                <li>STATUS: <span class="blink">ONLINE</span></li>
                <li>LOC: TOKYO, JP</li>
                <li>EST: 2024</li>
            </ul>
        </aside>

        <div class="main-content">
            <section class="latest-video-section" data-reveal data-channel-id="UC6VahhLMGPoY3_iqF_Cisuw">
                <div class="latest-video-label">LATEST MIX</div>
                <a href="#" class="latest-video-link" id="latest-video-link" target="_blank" rel="noopener" aria-label="YouTubeで最新動画を見る" style="display:none;">
                    <span class="latest-video-img" id="latest-video-img" data-thumb></span>
                </a>
                <p class="latest-video-fallback" id="latest-video-fallback" style="display:none;">
                    <a href="https://www.youtube.com/@RAVE2D" target="_blank" rel="noopener">YouTube チャンネルで最新動画を見る</a>
                </p>
            </section>

            <section id="about" class="tab-panel about-panel" data-reveal role="tabpanel" aria-labelledby="tab-about">
                <div class="section-label">ABOUT</div>
                <div class="about-inner">
                    <div class="about-story">
                        <p class="about-lead">インターネットとクラブの交差点。東京を拠点に、サブカルチャーなDJたちのミックスをアーカイブするチャンネル、RAVE 2D。</p>
                        <p class="about-en">The intersection of internet and club. RAVE 2D is a channel that archives mixes by subculture DJs based in Tokyo.</p>
                        <p>わたしたちは、アンダーグラウンドとインターネットの「狭間」から溢れ出る音を「2次元」に落とし込み、いつでもどこでも聴ける形で残していくプロジェクトです。上野・湯島の小さな地下室からはじまり、東京を中心とした様々なサブカルチャーの現場に足を運び、様々な音楽を収録しています。</p>
                        <p class="about-en">We are a project that turns the sounds emerging from the “in-between” of underground and internet into “2D,” preserving them so you can listen anytime, anywhere. It started in a small basement in Ueno–Yushima, and we’ve been going to various subculture spots around Tokyo to record all kinds of music.</p>
                        <p>ストリートで芽吹いたビーツ、小さな会場で紡がれたセット、次の世代に渡したいプレイリスト——それらを青い光のなかでアーカイブし、インターネットの海へ放ちます。</p>
                        <p class="about-en">Beats that sprouted on the street, sets woven in tiny venues, playlists we want to pass to the next generation—we archive them in blue light and send them out into the ocean of the internet.</p>
                        <p>東京のどこかで、今日も誰かがクラブで聴いている。その音のリアルを、青い炎で照らしています。</p>
                        <p class="about-en">Somewhere in Tokyo, someone is still listening at a club today. We’re lighting that reality of sound with a blue flame.</p>
                    </div>
                    <div class="about-actions">
                        <a href="https://www.youtube.com/@RAVE2D" class="btn about-youtube-btn" target="_blank" rel="noopener" data-hover>YOUTUBE</a>
                    </div>
                </div>
            </section>

            <section id="mix-catalog" class="catalog tab-panel" data-reveal role="tabpanel" aria-labelledby="tab-mix-catalog">
                <div class="section-label">MIX CATALOG</div>
                <div class="catalog-scroll">
                <article class="card" data-reveal data-stagger="0">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>MAEZAWA</h3>
                        <p>NAMBA,OSAKA / Hyper Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=Zucuy7bJBHI" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="1">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>KAMI-TO-WAKAI-SEYO</h3>
                        <p>ASAGAYA,TOKYO / Anime Remix Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=YNJcDYcDas8" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="2">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>RUUCHAN</h3>
                        <p>YUSHIMA,TOKYO / Future Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=5niSTk3l-B8" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="3">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>SYNTHION</h3>
                        <p>YUSHIMA,TOKYO / Futurecore Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=kuAh4C5q2oY" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="4">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>QW3R7Y</h3>
                        <p>YUSHIMA,TOKYO / Future House Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=sKOZn2K-Y5I" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="5">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>DIVINE ORACLE</h3>
                        <p>SHIMOKITAZAWA,TOKYO / House Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=j0G5mtGyyiA" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>

                <article class="card" data-reveal data-stagger="6">
                    <div class="card-img" data-thumb></div>
                    <div class="card-info">
                        <h3>MAEZAWA B2B MARBLE</h3>
                        <p>YUSHIMA,TOKYO / Hard Dance Vibes</p>
                    </div>
                    <a href="https://www.youtube.com/watch?v=jp980g578UY" class="card-link" target="_blank" rel="noopener">LISTEN</a>
                </article>
                </div>
            </section>

            <section id="events" class="catalog tab-panel" data-reveal role="tabpanel" aria-labelledby="tab-events">
                <div class="section-label">EVENTS</div>
                <div class="catalog-scroll">
                <article class="card" data-reveal data-stagger="0">
                    <span class="card-tag card-tag-upcoming">UPCOMING</span>
                    <div class="card-img" style="background-image: url('image/RAVE2D-HIGHWAY1.png');"></div>
                    <div class="card-info">
                        <h3>HIGHWAY</h3>
                        <p>IKEJIRI-OHASHI,TOKYO / 2026.02.08</p>
                    </div>
                    <a href="events/highway/" class="card-link" rel="noopener">DETAIL</a>
                </article>

                <article class="card" data-reveal data-stagger="1">
                    <div class="card-img" style="background-image: url('image/RAVE2D-OSAKA.png');"></div>
                    <div class="card-info">
                        <h3>OSAKA</h3>
                        <p>NAMBA,OSAKA / 2025.10.18</p>
                    </div>
                    <a href="events/osaka/" class="card-link" rel="noopener">DETAIL</a>
                </article>

                <article class="card" data-reveal data-stagger="2">
                    <div class="card-img" style="background-image: url('image/RAVE2D-ASAGAYA.png');"></div>
                    <div class="card-info">
                        <h3>ASAGAYA</h3>
                        <p>ASAGAYA,TOKYO / 2024.09.16</p>
                    </div>
                    <a href="events/asagaya/" class="card-link" rel="noopener">DETAIL</a>
                </article>
                </div>
            </section>

            <section id="ravewear" class="catalog tab-panel" data-reveal role="tabpanel" aria-labelledby="tab-ravewear">
                <div class="section-label">RAVE WEAR</div>
                <div class="catalog-scroll">
                <article class="card" data-reveal data-stagger="0">
                    <div class="card-img" style="background-image: url('image/TEE-MIXTAPE.png');"></div>
                    <div class="card-info">
                        <h3>MIXTAPE TEE</h3>
                        <p>BLACK / ¥6,000</p>
                    </div>
                    <a href="https://buy.stripe.com/fZu6oI9dP6Pe5MbcBt4Rq00" class="card-link" target="_blank" rel="noopener">BUY</a>
                </article>

                <article class="card" data-reveal data-stagger="1">
                    <div class="card-img" style="background-image: url('image/TEE-LOGO.png');"></div>
                    <div class="card-info">
                        <h3>LOGO TEE</h3>
                        <p>BLACK / ¥6,000</p>
                    </div>
                    <a href="https://buy.stripe.com/14AbJ275H3D2a2r8ld4Rq01" class="card-link" target="_blank" rel="noopener">BUY</a>
                </article>

                <article class="card" data-reveal data-stagger="2">
                    <div class="card-img" style="background-image: url('image/TEE-SMOKY.png');"></div>
                    <div class="card-info">
                        <h3>SMOKY TEE</h3>
                        <p>BLACK / ¥6,000</p>
                    </div>
                    <a href="https://buy.stripe.com/14A6oIgGh5LacazeJB4Rq02" class="card-link" target="_blank" rel="noopener">BUY</a>
                </article>
                </div>
            </section>
        </div>

        <!-- サムネイルポップアップ -->
        <div id="thumbnail-popup" class="popup-overlay" aria-hidden="true">
            <div class="popup-backdrop"></div>
            <div class="popup-content">
                <button type="button" class="popup-close" aria-label="閉じる">&times;</button>
                <img class="popup-img" src="" alt="YouTube サムネイル">
                <a href="#" class="popup-link btn" target="_blank" rel="noopener">Watch on YouTube</a>
            </div>
        </div>

        <!-- ポリシーポップアップ（RAVE WEAR） -->
        <div id="policy-popup" class="policy-popup-overlay" aria-hidden="true">
            <div class="policy-popup-backdrop"></div>
            <div class="policy-popup-box">
                <button type="button" class="policy-popup-close" aria-label="閉じる">&times;</button>
                <h2 class="policy-popup-title" id="policy-popup-title"></h2>
                <div class="policy-popup-body" id="policy-popup-body"></div>
            </div>
        </div>

        <!-- ポリシー本文（RAVE WEAR 服販売に関するもの） -->
        <template id="policy-privacy">
            <h2 class="policy-heading">プライバシーポリシー</h2>
            <p class="policy-updated">RAVE 2D（以下「当方」）は、RAVE WEAR の衣類販売および本ウェブサイトの利用において、お客様の個人情報を適切に取り扱います。</p>
            <h3>1. 収集する情報</h3>
            <p>ご注文・お問い合わせ時に、氏名・メールアドレス・配送先住所・電話番号・決済情報（Stripe 経由で処理、当方ではクレジットカード番号は保持しません）を収集することがあります。</p>
            <h3>2. 利用目的</h3>
            <p>注文の処理、商品の発送、ご連絡、返品・交換対応、および法令に基づく対応に利用します。</p>
            <h3>3. 第三者提供</h3>
            <p>決済処理のため Stripe に必要な情報を提供します。その他の第三者には、法令に基づく場合を除き、同意なく提供しません。</p>
            <h3>4. 保管・削除</h3>
            <p>必要に応じた期間保管したのち、適切に削除します。開示・訂正・削除のご希望はお問い合わせください。</p>
            <h3>5. お問い合わせ</h3>
            <p>プライバシーに関するお問い合わせは、本サイトまたは SNS（X / Instagram）の RAVE 2D アカウントまでご連絡ください。</p>
        </template>
        <template id="policy-terms">
            <h2 class="policy-heading">利用規約</h2>
            <p class="policy-updated">RAVE WEAR（RAVE 2D が提供する衣類販売）のご利用にあたり、以下の規約に同意いただいたものとみなします。</p>
            <h3>1. 適用</h3>
            <p>本規約は、RAVE WEAR の商品の購入および関連する一切のサービスに適用されます。</p>
            <h3>2. 注文・契約</h3>
            <p>ご注文は申込みとし、当方の注文確認（メール等）をもって契約が成立します。在庫切れ等の場合はご連絡のうえキャンセル・返金することがあります。</p>
            <h3>3. 代金・支払い</h3>
            <p>表示価格は税込です。支払いは注文時に Stripe 経由で行っていただきます。</p>
            <h3>4. 配送</h3>
            <p>配送先は日本国内に限らせていただく場合があります。配送日・時間の指定はお受けできない場合があります。</p>
            <h3>5. 返品・交換</h3>
            <p>商品の不良・誤配送の場合は返品・交換に対応します。お客様都合の返品は、未使用・未開封に限り、到着後〇日以内など別途案内に従ってご連絡ください。</p>
            <h3>6. 禁止事項</h3>
            <p>転売目的の大量購入、虚偽の申告、その他当方または第三者に不利益を与える行為を禁止します。</p>
            <h3>7. お問い合わせ</h3>
            <p>利用規約・注文に関するお問い合わせは、本サイトまたは SNS（RAVE 2D）までご連絡ください。</p>
        </template>
        <template id="policy-tokushoho">
            <h2 class="policy-heading">特定商取引法に基づく表記</h2>
            <p class="policy-updated">RAVE WEAR（衣類販売）における特定商取引法に基づく表記です。</p>
            <dl class="policy-dl">
                <dt>販売業者</dt>
                <dd>NEW ERA DESIGN, CO., LTD.</dd>
                <dt>代表者</dt>
                <dd>Ken Kojo</dd>
                <dt>所在地</dt>
                <dd>〒160-0023 東京都新宿区西新宿3丁目3番13号西新宿水間ビル2F</dd>
                <dt>連絡先</dt>
                <dd>本サイトまたは X(Twitter) / Instagram: @rave_2d の DM にてお問い合わせください。</dd>
                <dt>販売URL</dt>
                <dd>https://rave2d.com/</dd>
                <dt>商品代金</dt>
                <dd>各商品ページに表示の税込価格（送料は別途表示または注文フローで案内）</dd>
                <dt>支払方法</dt>
                <dd>クレジットカード（Stripe 経由）</dd>
                <dt>支払時期</dt>
                <dd>ご注文時</dd>
                <dt>商品の引き渡し時期</dt>
                <dd>入金確認後、15営業日以内に発送（詳細は注文確認メールでお知らせします）</dd>
                <dt>返品・キャンセル</dt>
                <dd>商品の不良・誤配送の場合は返品・交換に対応します。お客様都合の返品は、別途「利用規約」の返品条件に従います。</dd>
                <dt>その他</dt>
                <dd>本表記は RAVE WEAR の衣類販売に係るものです。表記内容は予告なく変更することがあります。</dd>
            </dl>
            <p class="policy-note">※ RAVE WEARはRAVE 2Dのアパレル形態を意味します。</p>
        </template>

        <footer class="footer">
            <div class="footer-links">
                <a href="https://x.com/rave_2d" target="_blank">X(TWITTER)</a>
                <a href="https://www.instagram.com/rave_2d/" target="_blank">INSTAGRAM</a>
                <a href="https://www.tiktok.com/@rave2d" target="_blank">TIKTOK</a>
            </div>
            <div class="footer-policy-links">
                <button type="button" class="footer-policy-link" data-policy="privacy">プライバシーポリシー</button>
                <span class="footer-policy-sep">/</span>
                <button type="button" class="footer-policy-link" data-policy="terms">利用規約</button>
                <span class="footer-policy-sep">/</span>
                <button type="button" class="footer-policy-link" data-policy="tokushoho">特定商取引法に基づく表記</button>
            </div>
            <div class="copy">© RAVE 2D ALL RIGHTS RESERVED.</div>
        </footer>

    </div>

    <script>
(function () {
    /* --- Loader: 表示→非表示 --- */
    var loader = document.querySelector('.loader');
    function hideLoader() {
        if (!loader) return;
        loader.classList.add('is-hidden');
        setTimeout(function () {
            loader.style.display = 'none';
            revealOnLoad();
        }, 600);
    }
    if (document.readyState === 'complete') {
        setTimeout(hideLoader, 1200);
    } else {
        window.addEventListener('load', function () { setTimeout(hideLoader, 1200); });
    }

    /* --- 初回表示: ヒーロー・ヘッダーの data-reveal / data-split --- */
    function revealOnLoad() {
        document.querySelectorAll('.header[data-reveal], .header [data-reveal], .hero [data-reveal], .hero [data-split]').forEach(function (el) {
            el.classList.add('is-visible');
        });
        /* メインコンテンツ以降はスクロールで表示 */
        document.querySelectorAll('.main-content [data-reveal]').forEach(function (el) {
            scrollRevealObserver.observe(el);
        });
    }

    /* --- スクロールで表示: Intersection Observer --- */
    var scrollRevealObserver = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
            }
        });
    }, { rootMargin: '0px 0px -60px 0px', threshold: 0.05 });

    function getYoutubeId(url) {
        if (!url) return null;
        try {
            var u = new URL(url);
            if (u.hostname === 'youtu.be') return u.pathname.slice(1);
            return u.searchParams.get('v');
        } catch (_) { return null; }
    }
    function thumbnailUrl(id) {
        return 'https://img.youtube.com/vi/' + id + '/maxresdefault.jpg';
    }
    function thumbnailUrlFallback(id) {
        return 'https://img.youtube.com/vi/' + id + '/hqdefault.jpg';
    }

    /* --- 最新動画: RSS でタイトルに "RAVE 2D:" を含む最新の1本を表示。API不要。サムネは thumbnailUrl / thumbnailUrlFallback --- */
    (function () {
        var section = document.querySelector('.latest-video-section[data-channel-id]');
        var linkEl = document.getElementById('latest-video-link');
        var thumbEl = document.getElementById('latest-video-img');
        var fallback = document.getElementById('latest-video-fallback');
        if (!section || !linkEl || !thumbEl) return;
        var channelId = section.getAttribute('data-channel-id');
        if (!channelId) return;
        var titleFilter = 'RAVE 2D:';

        function showVideo(videoId) {
            if (!videoId) {
                linkEl.style.display = 'none';
                if (fallback) fallback.style.display = 'block';
                return;
            }
            if (fallback) fallback.style.display = 'none';
            linkEl.href = 'https://www.youtube.com/watch?v=' + videoId;
            linkEl.style.display = 'block';
            var hi = thumbnailUrl(videoId);
            var lo = thumbnailUrlFallback(videoId);
            thumbEl.style.backgroundImage = 'url(' + hi + ')';
            thumbEl.style.backgroundSize = 'contain';
            thumbEl.style.backgroundPosition = 'center';
            thumbEl.style.backgroundRepeat = 'no-repeat';
            var img = new Image();
            img.onerror = function () { thumbEl.style.backgroundImage = 'url(' + lo + ')'; };
            img.src = hi;
        }

        var rssUrl = 'https://www.youtube.com/feeds/videos.xml?channel_id=' + channelId;
        var proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rssUrl);
        fetch(proxyUrl)
            .then(function (res) { return res.text(); })
            .then(function (xml) {
                var entries = xml.match(/<entry>[\s\S]*?<\/entry>/g) || [];
                var videoId = null;
                for (var e = 0; e < entries.length; e++) {
                    var entry = entries[e];
                    var idMatch = entry.match(/yt:video:([a-zA-Z0-9_-]{11})/);
                    var titleMatch = entry.match(/<title[^>]*>([\s\S]*?)<\/title>/);
                    var title = titleMatch ? titleMatch[1].replace(/<!\[CDATA\[|\]\]>/g, '').trim() : '';
                    if (idMatch && title.indexOf(titleFilter) !== -1) {
                        videoId = idMatch[1];
                        break;
                    }
                }
                if (!videoId && entries.length > 0) {
                    var firstMatch = entries[0].match(/yt:video:([a-zA-Z0-9_-]{11})/);
                    if (firstMatch) videoId = firstMatch[1];
                }
                showVideo(videoId);
            })
            .catch(function () {
                linkEl.style.display = 'none';
                if (fallback) fallback.style.display = 'block';
            });
    })();

    var popup = document.getElementById('thumbnail-popup');
    var popupImg = popup && popup.querySelector('.popup-img');
    var popupLink = popup && popup.querySelector('.popup-link');
    var popupClose = popup && popup.querySelector('.popup-close');
    var popupBackdrop = popup && popup.querySelector('.popup-backdrop');

    document.querySelectorAll('.catalog .card-link').forEach(function (link) {
        var id = getYoutubeId(link.href);
        if (!id) return;
        var card = link.closest('.card');
        var thumbEl = card && card.querySelector('[data-thumb]');
        if (thumbEl) {
            var hi = thumbnailUrl(id);
            var lo = thumbnailUrlFallback(id);
            thumbEl.style.backgroundImage = 'url(' + hi + ')';
            thumbEl.style.backgroundSize = 'cover';
            thumbEl.style.backgroundPosition = 'right center';
            var img = new Image();
            img.onerror = function () { thumbEl.style.backgroundImage = 'url(' + lo + ')'; };
            img.src = hi;
        }
        link.addEventListener('click', function (e) {
            e.preventDefault();
            if (!popup || !popupImg || !popupLink) return;
            popupImg.src = thumbnailUrlFallback(id);
            popupImg.onerror = function () { this.src = thumbnailUrlFallback(id); };
            popupImg.src = thumbnailUrl(id);
            popupLink.href = link.href;
            popup.setAttribute('aria-hidden', 'false');
            popup.classList.add('is-open');
        });
    });

    /* --- カード画像クリックでリンク先へ（全セクション共通） --- */
    document.querySelectorAll('.card').forEach(function (card) {
        var img = card.querySelector('.card-img');
        var link = card.querySelector('.card-link');
        if (img && link) {
            img.addEventListener('click', function () { link.click(); });
        }
    });

    function closePopup() {
        if (!popup) return;
        popup.setAttribute('aria-hidden', 'true');
        popup.classList.remove('is-open');
    }
    if (popupClose) popupClose.addEventListener('click', closePopup);
    if (popupBackdrop) popupBackdrop.addEventListener('click', closePopup);

    /* --- ポリシーポップアップ: プライバシー / 利用規約 / 特定商取引法 --- */
    var policyPopup = document.getElementById('policy-popup');
    var policyTitleEl = document.getElementById('policy-popup-title');
    var policyBodyEl = document.getElementById('policy-popup-body');
    var policyCloseBtn = policyPopup && policyPopup.querySelector('.policy-popup-close');
    var policyBackdrop = policyPopup && policyPopup.querySelector('.policy-popup-backdrop');
    var policyTitles = { privacy: 'プライバシーポリシー', terms: '利用規約', tokushoho: '特定商取引法に基づく表記' };

    function openPolicyPopup(type) {
        var tpl = document.getElementById('policy-' + type);
        if (!policyPopup || !policyTitleEl || !policyBodyEl || !tpl) return;
        policyTitleEl.textContent = policyTitles[type] || type;
        policyBodyEl.innerHTML = '';
        policyBodyEl.appendChild(tpl.content.cloneNode(true));
        policyPopup.setAttribute('aria-hidden', 'false');
        policyPopup.classList.add('is-open');
    }
    function closePolicyPopup() {
        if (!policyPopup) return;
        policyPopup.setAttribute('aria-hidden', 'true');
        policyPopup.classList.remove('is-open');
    }
    document.querySelectorAll('.footer-policy-link').forEach(function (btn) {
        btn.addEventListener('click', function () {
            var type = this.getAttribute('data-policy');
            if (type) openPolicyPopup(type);
        });
    });
    if (policyCloseBtn) policyCloseBtn.addEventListener('click', closePolicyPopup);
    if (policyBackdrop) policyBackdrop.addEventListener('click', closePolicyPopup);

    document.addEventListener('keydown', function (e) {
        if (e.key !== 'Escape') return;
        if (marqueeSection && marqueeSection.classList.contains('is-menu-open')) { closeNav(); return; }
        if (policyPopup && policyPopup.classList.contains('is-open')) closePolicyPopup();
        else closePopup();
    });

    /* --- ハンバーガーメニュー開閉（マーキー内インライン表示） --- */
    var hamburgerBtn = document.querySelector('.hamburger-btn');
    var navMenu = document.getElementById('nav-menu');
    var marqueeSection = document.getElementById('marquee-glitch');
    function openNav() {
        if (!marqueeSection || !hamburgerBtn) return;
        marqueeSection.classList.add('is-menu-open');
        if (navMenu) navMenu.setAttribute('aria-hidden', 'false');
        hamburgerBtn.setAttribute('aria-expanded', 'true');
        hamburgerBtn.setAttribute('aria-label', 'メニューを閉じる');
    }
    function closeNav() {
        if (!marqueeSection || !hamburgerBtn) return;
        marqueeSection.classList.remove('is-menu-open');
        if (navMenu) navMenu.setAttribute('aria-hidden', 'true');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
        hamburgerBtn.setAttribute('aria-label', 'メニューを開く');
    }
    function toggleNav() {
        if (marqueeSection && marqueeSection.classList.contains('is-menu-open')) closeNav();
        else openNav();
    }
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleNav);
    document.querySelectorAll('.marquee-nav .marquee-nav-link').forEach(function (link) {
        link.addEventListener('click', function () {
            closeNav();
        });
    });

    /* --- タブ切り替え: ABOUT / CATALOG / EVENTS / RAVE WEAR（ハンバーガー内リンク含む） --- */
    var tabBtns = document.querySelectorAll('.tab-btn');
    var tabPanels = document.querySelectorAll('.main-content .tab-panel');
    var tabIds = ['about', 'mix-catalog', 'events', 'ravewear'];

    function switchTab(targetId) {
        var id = (targetId && tabIds.indexOf(targetId) >= 0) ? targetId : null;
        tabPanels.forEach(function (panel) {
            panel.classList.toggle('is-active', id !== null && panel.id === id);
            panel.setAttribute('aria-hidden', id === null || panel.id !== id);
        });
        tabBtns.forEach(function (btn) {
            var href = btn.getAttribute('href') || '';
            var btnId = href.slice(1);
            btn.classList.toggle('is-active', id !== null && btnId === id);
            btn.setAttribute('aria-selected', id !== null && btnId === id);
        });
        var latestSection = document.querySelector('.latest-video-section');
        if (latestSection) latestSection.classList.toggle('is-hidden', id !== null);
        if (history.replaceState) history.replaceState(null, '', id ? '#' + id : window.location.pathname || '');
    }

    tabBtns.forEach(function (btn) {
        btn.addEventListener('click', function (e) {
            var href = this.getAttribute('href') || '';
            var id = href.slice(1);
            if (tabIds.indexOf(id) >= 0) {
                e.preventDefault();
                switchTab(id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });

    function initTabFromHash() {
        var hash = (location.hash || '').slice(1);
        if (tabIds.indexOf(hash) >= 0) {
            switchTab(hash);
        } else {
            switchTab(null);
        }
    }
    if (document.readyState === 'complete') initTabFromHash();
    else window.addEventListener('load', initTabFromHash);
    window.addEventListener('hashchange', initTabFromHash);
})();

    /* --- Marquee: 点滅は廃止、色変化はCSSアニメーションで実施 --- */
    (function () {
        var slicesContainer = document.getElementById('glitch-slices-js');
        if (!slicesContainer) return;
        var sliceCount = 8;
        var i;
        for (i = 0; i < sliceCount; i++) {
            var slice = document.createElement('div');
            slice.className = 'glitch-slice-js';
            slice.style.top = (i / sliceCount * 100) + '%';
            slicesContainer.appendChild(slice);
        }
    })();
    </script>
</body>
</html>